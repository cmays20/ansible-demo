---
- hosts: all
  tasks:
- name: install first domain controller
  hosts: all
  gather_facts: yes
  tasks:
   - name: install ad
     win_feature: >
          name=AD-Domain-Services
          include_management_tools=yes
          include_sub_features=yes
          state=present
     register: result
   - name: install domain
     win_domain: >
       dns_domain_name=rhansibledemo.com
       safe_mode_password={{ ansible_password }}     
     register: ad
   - name: reboot server
     win_reboot:
      msg: "Installing AD. Rebooting..."
      pre_reboot_delay: 20
     when: ad.changed
